#!/bin/sh

PATH=/sbin:/bin:/usr/sbin:/usr/bin:@prefix@/sbin:@prefix@/bin
prefix=@prefix@
exec_prefix=@exec_prefix@

IPTABLES=/sbin/iptables

case "$1" in
  add)
    $IPTABLES -t nat -I ${2}_nat_vip_post -s ${3} -j SNAT --to-source ${4}
    if [ $? -eq 0 ]; then
      echo "Adding VIP map: ${3} => ${4}"
    fi
    ;;
  del)
    $IPTABLES -t nat -D ${2}_nat_vip_post -s ${3} -j SNAT --to-source ${4}
    if [ $? -eq 0 ]; then
      echo "Deleting VIP map: ${3} => ${4}"
    fi
    ;;
  *)
    N=@sbindir@/rahunas-vipmap
    echo "Usage: $N {add|del} vserver_name client_ip vipmap_ip"
    exit 3
    ;;
esac 

exit 0
